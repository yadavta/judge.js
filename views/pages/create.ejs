<!DOCTYPE html>
<html>
<head>
    <%- include ("../partials/header.ejs") %>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>


  <%- include ("../partials/nav.ejs") %>

<section class="section">
    <form id="createTournamentForm">
        <div class="field">
            <label>Colloquial Tournament Name</label>
            <input class="input is-primary" id="informalName" type="text" placeholder="informal tourney name">
        </div>
        <div class="field">
          <label>Official Tabroom Name</label>
          <input class= "input is-primary"  id="formalName" type="text" placeholder="tab tourney name">
        </div>
    </form>

</section>

<!-- tournament creation form with user input -->




<!-- get tournament dates using calendar picker
  <div class="two fields">
    <div class="field">
      <label>Start date</label>
      <div class="ui calendar" id="rangestart">
        <div class="ui input left icon">
          <i class="calendar icon"></i>
          <input type="text" placeholder="Start">
        </div>
      </div>
    </div>
    <div class="field">
      <label>End date</label>
      <div class="ui calendar" id="rangeend">
        <div class="ui input left icon">
          <i class="calendar icon"></i>
          <input type="text" placeholder="End">
        </div>
      </div>
    </div>
  </div>

  <!-- select which circuit it is in
  <div class="inline field">
      <p>Applicable Circuits: </p>
      <div class="ui checkbox">
        <input type="checkbox" tabindex="0" class="hidden" id="natCircuitCheckbox">
        <label>National Circuit</label>
      </div>
      <div class="ui checkbox">
        <input type="checkbox" tabindex="0" class="hidden" id="localCircuitCheckbox">
        <label>Local Circuit</label>
      </div>
  </div>

<!-- if tourney is school approved + if going to tourney as Independent
  <div class="inline field">
      <p>Formal Classifications: </p>
      <div class="ui toggle checkbox">
        <input type="checkbox" tabindex="0" class="hidden" id="schoolApprovedToggleBox">
        <label>School Approved?</label>
      </div>
      <div class="ui toggle checkbox">
        <input type="checkbox" tabindex="0" class="hidden" id="asIndependentToggleBox">
        <label>As Independent?</label>
      </div>
  </div>

<!-- judges needed
  <div class="inline field">
      <p>Target Judges: </p>
      <div class="ui checkbox">
        <input type="checkbox" tabindex="0" class="hidden" id="parentsJudgesCheckbox">
        <label>Parents and Volunteers</label>
      </div>
      <div class="ui checkbox">
        <input type="checkbox" tabindex="0" class="hidden" id="hiresJudgesCheckbox">
        <label>Hires</label>
      </div>
  </div>

<!-- select events attending
  <div class="field">
    <label>Events Attending</label>
    <select multiple="" class="ui dropdown">
     <option value="">Select Events</option>
     <option value="ld">Lincoln Douglas</option>
     <option value="cx">Policy</option>
     <option value="pf">Public Forum</option>
     <option value="cong">Congress</option>
     <option value="speech">Speech</option>
   </select>
  </div>

  <!-- form validation button
  <button class = "ui primary button" id="validationButton"> Validate Inputs </button>
<%# </form> -->

<!-- submit button; note that this uses basic html/jquery, not semantic UI. semantic's form plugin is used only for validation and UI -->
<div class = "ui fun">
  <button class = "ui violet button" id="submitButton"> Create Tournament </button>
</div>

  <script>
  // neccessary bits for form functionality
    //calendar date picker

    $('#rangestart').calendar({
      type: 'date',
      endCalendar: $('#rangeend')
    });

    $('#rangeend').calendar({
      type: 'date',
      startCalendar: $('#rangestart')
    });

    //circuit checkboxes
    $('.ui.checkbox')
      .checkbox();

    //multiple select
    $('select.dropdown')
      .dropdown()
    ;

    // setting up basic variables
    let userTournamentID = "";
    let userTournamentName = "";
    let userTabroomName = "";
    let userCircuits = [];
    let userJudges = [];
    let userSchoolApproved = false;
    let userAsIndependent = false;
    let currentYear = new Date().getFullYear();
    let userStartDate = "";
    let userEndDate = "";

    // getting user inptu via jquery
    $('#submitButton').click(function() {

      userTournamentName = $('#informalName').val();
      userTabroomName = $('#formalName').val();
      userTournamentID = userTournamentName.toLowerCase() + currentYear;

      if($('#natCircuitCheckbox').prop('checked')) {
        userCircuits.push("national");
      }
      if ($('#localCircuitCheckbox').prop('checked')) {
        userCircuits.push("local");
      }

      if($('#parentsJudgesCheckbox').prop('checked')) {
        userJudges.push("parents");
      }

      if($('#hiresJudgesCheckbox').prop('checked')) {
        userJudges.push("hires")
      }

      if($('#schoolApprovedToggleBox').prop('checked')) {
        userSchoolApproved = true;
      }
      if($('#asIndependentToggleBox').prop('checked')) {
        userAsIndependent = true;
      }

      //dates are stored as ISO 8601 format to ensure compatibility with MongoDB query
      let userStartDate = $('#rangestart').calendar('get date');
      let userEndDate = $('#rangeend').calendar('get date');

      axios.post("/createTournament", {
        _id: userTournamentID,
        tournamentName: userTournamentName,
        tabroomName: userTabroomName,
        circuits: userCircuits,
        judgeTypes: userJudges,
        schoolApproved: userSchoolApproved,
        asIndependent: userAsIndependent,
        startDate: userStartDate,
        endDate: userEndDate
      })
      .then(function (response) {
          console.log(response);
      })
      .catch(function (error) {
          console.log(error);
      });

    });

  </script>
</body>

</html>
